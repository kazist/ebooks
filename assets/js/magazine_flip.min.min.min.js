
function addPage(b,e){var c,d=e.turn("pages");var a=$("<div />",{});if(e.turn("addPage",a,b)){a.html('<div class="gradient"></div><div class="loader"></div>');loadPage(b,a)}}function loadPage(a,c){var b=$("<img />");b.mousedown(function(d){d.preventDefault()});b.load(function(){$(this).css({width:"100%",height:"100%"});$(this).appendTo(c);c.find(".loader").remove()});b.attr("src","pages/"+a+".jpg");loadRegions(a,c)}function zoomTo(a){setTimeout(function(){if($(".magazine-viewport").data().regionClicked){$(".magazine-viewport").data().regionClicked=false}else{if($(".magazine-viewport").zoom("value")==1){$(".magazine-viewport").zoom("zoomIn",a)}else{$(".magazine-viewport").zoom("zoomOut")}}},1)}function loadRegions(b,a){$.getJSON("pages/"+b+"-regions.json").done(function(c){$.each(c,function(e,d){addRegion(d,a)})})}function addRegion(d,a){var b=$("<div />",{"class":"region  "+d["class"]}),f=$(".magazine").turn("options"),e=f.width/2,c=f.height;b.css({top:Math.round(d.y/c*100)+"%",left:Math.round(d.x/e*100)+"%",width:Math.round(d.width/e*100)+"%",height:Math.round(d.height/c*100)+"%"}).attr("region-data",$.param(d.data||""));b.appendTo(a)}function regionClick(c){var a=$(c.target);if(a.hasClass("region")){$(".magazine-viewport").data().regionClicked=true;setTimeout(function(){$(".magazine-viewport").data().regionClicked=false},100);var b=$.trim(a.attr("class").replace("region",""));return processRegion(a,b)}}function processRegion(b,e){data=decodeParams(b.attr("region-data"));switch(e){case"link":window.open(data.url);break;case"zoom":var a=b.offset(),d=$(".magazine-viewport").offset(),c={x:a.left-d.left,y:a.top-d.top};$(".magazine-viewport").zoom("zoomIn",c);break;case"to-page":$(".magazine").turn("page",data.page);break}}function loadLargePage(a,c){var b=$("<img />");b.load(function(){var d=c.find("img");$(this).css({width:"100%",height:"100%"});$(this).appendTo(c);d.remove()});b.attr("src","pages/"+a+"-large.jpg")}function loadSmallPage(a,c){var b=c.find("img");b.css({width:"100%",height:"100%"});b.unbind("load");b.attr("src","pages/"+a+".jpg")}function isChrome(){return navigator.userAgent.indexOf("Chrome")!=-1}function disableControls(a){if(a==1){$(".previous-button").hide()}else{$(".previous-button").show()}if(a==$(".magazine").turn("pages")){$(".next-button").hide()}else{$(".next-button").show()}}function resizeViewport(){var b=$(window).width(),e=$(window).height(),f=$(".magazine").turn("options");$(".magazine").removeClass("animated");$(".magazine-viewport").css({width:b,height:e}).zoom("resize");if($(".magazine").turn("zoom")==1){var a=calculateBound({width:f.width,height:f.height,boundWidth:Math.min(f.width,b),boundHeight:Math.min(f.height,e)});if(a.width%2!==0){a.width-=1}if(a.width!=$(".magazine").width()||a.height!=$(".magazine").height()){$(".magazine").turn("size",a.width,a.height);if($(".magazine").turn("page")==1){$(".magazine").turn("peel","br")}$(".next-button").css({height:a.height,backgroundPosition:"-38px "+(a.height/2-32/2)+"px"});$(".previous-button").css({height:a.height,backgroundPosition:"-4px "+(a.height/2-32/2)+"px"})}$(".magazine").css({top:-a.height/2,left:-a.width/2})}var d=$(".magazine").offset(),g=e-d.top-$(".magazine").height(),c=(g-$(".thumbnails > div").height())/2;if(c<0){$(".thumbnails").css({height:1})}else{$(".thumbnails").css({height:g});$(".thumbnails > div").css({marginTop:c})}if(d.top<$(".made").height()){$(".made").hide()}else{$(".made").show()}$(".magazine").addClass("animated")}function numberOfViews(a){return a.turn("pages")/2+1}function getViewNumber(a,b){return parseInt((b||a.turn("page"))/2+1,10)}function moveBar(a){if(Modernizr&&Modernizr.csstransforms){$("#slider .ui-slider-handle").css({zIndex:a?-1:10000})}}function setPreview(f){var a=112,e=73,d="pages/preview.jpg",c=$(_thumbPreview.children(":first")),g=(f==1||f==$("#slider").slider("option","max"))?1:2,b=(g==1)?a/2:a;_thumbPreview.addClass("no-transition").css({width:b+15,height:e+15,top:-e-30,left:($($("#slider").children(":first")).width()-b-15)/2});c.css({width:b,height:e});if(c.css("background-image")===""||c.css("background-image")=="none"){c.css({backgroundImage:"url("+d+")"});setTimeout(function(){_thumbPreview.removeClass("no-transition")},0)}c.css({backgroundPosition:"0px -"+((f-1)*e)+"px"})}function largeMagazineWidth(){return 2214}function decodeParams(f){var b=f.split("&"),c,a={};for(var e=0;e<b.length;e++){c=b[e].split("=");a[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return a}function calculateBound(a){var c={width:a.width,height:a.height};if(c.width>a.boundWidth||c.height>a.boundHeight){var b=c.width/c.height;if(a.boundWidth/b>a.boundHeight&&a.boundHeight*b<=a.boundWidth){c.width=Math.round(a.boundHeight*b);c.height=a.boundHeight}else{c.width=a.boundWidth;c.height=Math.round(a.boundWidth/b)}}return c};