
function addPage(d, b){var e, a = b.turn("pages"); var c = $("<div />", {}); if (b.turn("addPage", c, d)){c.html('<div class="gradient"></div><div class="loader"></div>'); loadPage(d, c)}}function loadPage(c, b){var a = $("<img />"); a.mousedown(function(d){d.preventDefault()}); a.load(function(){$(this).css({width:"100%", height:"100%"}); $(this).appendTo(b); b.find(".loader").remove()}); a.attr("src", "pages/" + c + ".jpg"); loadRegions(c, b)}function zoomTo(a){setTimeout(function(){if ($(".magazine-viewport").data().regionClicked){$(".magazine-viewport").data().regionClicked = false} else{if ($(".magazine-viewport").zoom("value") == 1){$(".magazine-viewport").zoom("zoomIn", a)} else{$(".magazine-viewport").zoom("zoomOut")}}}, 1)}function loadRegions(b, a){$.getJSON("pages/" + b + "-regions.json").done(function(c){$.each(c, function(d, e){addRegion(e, a)})})}function addRegion(f, c){var d = $("<div />", {"class":"region  " + f["class"]}), b = $(".magazine").turn("options"), a = b.width / 2, e = b.height; d.css({top:Math.round(f.y / e * 100) + "%", left:Math.round(f.x / a * 100) + "%", width:Math.round(f.width / a * 100) + "%", height:Math.round(f.height / e * 100) + "%"}).attr("region-data", $.param(f.data || "")); d.appendTo(c)}function regionClick(b){var c = $(b.target); if (c.hasClass("region")){$(".magazine-viewport").data().regionClicked = true; setTimeout(function(){$(".magazine-viewport").data().regionClicked = false}, 100); var a = $.trim(c.attr("class").replace("region", "")); return processRegion(c, a)}}function processRegion(d, b){data = decodeParams(d.attr("region-data")); switch (b){case"link":window.open(data.url); break; case"zoom":var c = d.offset(), a = $(".magazine-viewport").offset(), e = {x:c.left - a.left, y:c.top - a.top}; $(".magazine-viewport").zoom("zoomIn", e); break; case"to-page":$(".magazine").turn("page", data.page); break}}function loadLargePage(c, b){var a = $("<img />"); a.load(function(){var d = b.find("img"); $(this).css({width:"100%", height:"100%"}); $(this).appendTo(b); d.remove()}); a.attr("src", "pages/" + c + "-large.jpg")}function loadSmallPage(c, b){var a = b.find("img"); a.css({width:"100%", height:"100%"}); a.unbind("load"); a.attr("src", "pages/" + c + ".jpg")}function isChrome(){return navigator.userAgent.indexOf("Chrome") != - 1}function disableControls(a){if (a == 1){$(".previous-button").hide()} else{$(".previous-button").show()}if (a == $(".magazine").turn("pages")){$(".next-button").hide()} else{$(".next-button").show()}}function resizeViewport(){var e = $(window).width(), a = $(window).height(), b = $(".magazine").turn("options"); $(".magazine").removeClass("animated"); $(".magazine-viewport").css({width:e, height:a}).zoom("resize"); if ($(".magazine").turn("zoom") == 1){var d = calculateBound({width:b.width, height:b.height, boundWidth:Math.min(b.width, e), boundHeight:Math.min(b.height, a)}); if (d.width % 2 !== 0){d.width -= 1}if (d.width != $(".magazine").width() || d.height != $(".magazine").height()){$(".magazine").turn("size", d.width, d.height); if ($(".magazine").turn("page") == 1){$(".magazine").turn("peel", "br")}$(".next-button").css({height:d.height, backgroundPosition:"-38px " + (d.height / 2 - 32 / 2) + "px"}); $(".previous-button").css({height:d.height, backgroundPosition:"-4px " + (d.height / 2 - 32 / 2) + "px"})}$(".magazine").css({top: - d.height / 2, left: - d.width / 2})}var g = $(".magazine").offset(), c = a - g.top - $(".magazine").height(), f = (c - $(".thumbnails > div").height()) / 2; if (f < 0){$(".thumbnails").css({height:1})} else{$(".thumbnails").css({height:c}); $(".thumbnails > div").css({marginTop:f})}if (g.top < $(".made").height()){$(".made").hide()} else{$(".made").show()}$(".magazine").addClass("animated")}function numberOfViews(a){return a.turn("pages") / 2 + 1}function getViewNumber(a, b){return parseInt((b || a.turn("page")) / 2 + 1, 10)}function moveBar(a){if (Modernizr && Modernizr.csstransforms){$("#slider .ui-slider-handle").css({zIndex:a? - 1:10000})}}function setPreview(b){var d = 112, a = 73, g = "pages/preview.jpg", f = $(_thumbPreview.children(":first")), c = (b == 1 || b == $("#slider").slider("option", "max"))?1:2, e = (c == 1)?d / 2:d; _thumbPreview.addClass("no-transition").css({width:e + 15, height:a + 15, top: - a - 30, left:($($("#slider").children(":first")).width() - e - 15) / 2}); f.css({width:e, height:a}); if (f.css("background-image") === "" || f.css("background-image") == "none"){f.css({backgroundImage:"url(" + g + ")"}); setTimeout(function(){_thumbPreview.removeClass("no-transition")}, 0)}f.css({backgroundPosition:"0px -" + ((b - 1) * a) + "px"})}function largeMagazineWidth(){return 2214}function decodeParams(b){var e = b.split("&"), f, c = {}; for (var a = 0; a < e.length; a++){f = e[a].split("="); c[decodeURIComponent(f[0])] = decodeURIComponent(f[1])}return c}function calculateBound(c){var b = {width:c.width, height:c.height}; if (b.width > c.boundWidth || b.height > c.boundHeight){var a = b.width / b.height; if (c.boundWidth / a > c.boundHeight && c.boundHeight * a <= c.boundWidth){b.width = Math.round(c.boundHeight * a); b.height = c.boundHeight} else{b.width = c.boundWidth; b.height = Math.round(c.boundWidth / a)}}return b};