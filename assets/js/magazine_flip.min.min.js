
function addPage(i, f){var h, g = f.turn("pages"); var j = $("<div />", {}); if (f.turn("addPage", j, i)){j.html('<div class="gradient"></div><div class="loader"></div>'); loadPage(i, j)}}function loadPage(f, d){var e = $("<img />"); e.mousedown(function(a){a.preventDefault()}); e.load(function(){$(this).css({width:"100%", height:"100%"}); $(this).appendTo(d); d.find(".loader").remove()}); e.attr("src", "pages/" + f + ".jpg"); loadRegions(f, d)}function zoomTo(b){setTimeout(function(){if ($(".magazine-viewport").data().regionClicked){$(".magazine-viewport").data().regionClicked = false} else{if ($(".magazine-viewport").zoom("value") == 1){$(".magazine-viewport").zoom("zoomIn", b)} else{$(".magazine-viewport").zoom("zoomOut")}}}, 1)}function loadRegions(c, d){$.getJSON("pages/" + c + "-regions.json").done(function(a){$.each(a, function(f, b){addRegion(b, d)})})}function addRegion(i, l){var k = $("<div />", {"class":"region  " + i["class"]}), g = $(".magazine").turn("options"), h = g.width / 2, j = g.height; k.css({top:Math.round(i.y / j * 100) + "%", left:Math.round(i.x / h * 100) + "%", width:Math.round(i.width / h * 100) + "%", height:Math.round(i.height / j * 100) + "%"}).attr("region-data", $.param(i.data || "")); k.appendTo(l)}function regionClick(d){var f = $(d.target); if (f.hasClass("region")){$(".magazine-viewport").data().regionClicked = true; setTimeout(function(){$(".magazine-viewport").data().regionClicked = false}, 100); var e = $.trim(f.attr("class").replace("region", "")); return processRegion(f, e)}}function processRegion(i, f){data = decodeParams(i.attr("region-data")); switch (f){case"link":window.open(data.url); break; case"zoom":var j = i.offset(), g = $(".magazine-viewport").offset(), h = {x:j.left - g.left, y:j.top - g.top}; $(".magazine-viewport").zoom("zoomIn", h); break; case"to-page":$(".magazine").turn("page", data.page); break}}function loadLargePage(f, d){var e = $("<img />"); e.load(function(){var a = d.find("img"); $(this).css({width:"100%", height:"100%"}); $(this).appendTo(d); a.remove()}); e.attr("src", "pages/" + f + "-large.jpg")}function loadSmallPage(f, d){var e = d.find("img"); e.css({width:"100%", height:"100%"}); e.unbind("load"); e.attr("src", "pages/" + f + ".jpg")}function isChrome(){return navigator.userAgent.indexOf("Chrome") != - 1}function disableControls(b){if (b == 1){$(".previous-button").hide()} else{$(".previous-button").show()}if (b == $(".magazine").turn("pages")){$(".next-button").hide()} else{$(".next-button").show()}}function resizeViewport(){var l = $(window).width(), i = $(window).height(), h = $(".magazine").turn("options"); $(".magazine").removeClass("animated"); $(".magazine-viewport").css({width:l, height:i}).zoom("resize"); if ($(".magazine").turn("zoom") == 1){var m = calculateBound({width:h.width, height:h.height, boundWidth:Math.min(h.width, l), boundHeight:Math.min(h.height, i)}); if (m.width % 2 !== 0){m.width -= 1}if (m.width != $(".magazine").width() || m.height != $(".magazine").height()){$(".magazine").turn("size", m.width, m.height); if ($(".magazine").turn("page") == 1){$(".magazine").turn("peel", "br")}$(".next-button").css({height:m.height, backgroundPosition:"-38px " + (m.height / 2 - 32 / 2) + "px"}); $(".previous-button").css({height:m.height, backgroundPosition:"-4px " + (m.height / 2 - 32 / 2) + "px"})}$(".magazine").css({top: - m.height / 2, left: - m.width / 2})}var j = $(".magazine").offset(), n = i - j.top - $(".magazine").height(), k = (n - $(".thumbnails > div").height()) / 2; if (k < 0){$(".thumbnails").css({height:1})} else{$(".thumbnails").css({height:n}); $(".thumbnails > div").css({marginTop:k})}if (j.top < $(".made").height()){$(".made").hide()} else{$(".made").show()}$(".magazine").addClass("animated")}function numberOfViews(b){return b.turn("pages") / 2 + 1}function getViewNumber(d, c){return parseInt((c || d.turn("page")) / 2 + 1, 10)}function moveBar(b){if (Modernizr && Modernizr.csstransforms){$("#slider .ui-slider-handle").css({zIndex:b? - 1:10000})}}function setPreview(h){var m = 112, i = 73, j = "pages/preview.jpg", k = $(_thumbPreview.children(":first")), n = (h == 1 || h == $("#slider").slider("option", "max"))?1:2, l = (n == 1)?m / 2:m; _thumbPreview.addClass("no-transition").css({width:l + 15, height:i + 15, top: - i - 30, left:($($("#slider").children(":first")).width() - l - 15) / 2}); k.css({width:l, height:i}); if (k.css("background-image") === "" || k.css("background-image") == "none"){k.css({backgroundImage:"url(" + j + ")"}); setTimeout(function(){_thumbPreview.removeClass("no-transition")}, 0)}k.css({backgroundPosition:"0px -" + ((h - 1) * i) + "px"})}function largeMagazineWidth(){return 2214}function decodeParams(d){var i = d.split("&"), h, j = {}; for (var g = 0; g < i.length; g++){h = i[g].split("="); j[decodeURIComponent(h[0])] = decodeURIComponent(h[1])}return j}function calculateBound(f){var d = {width:f.width, height:f.height}; if (d.width > f.boundWidth || d.height > f.boundHeight){var e = d.width / d.height; if (f.boundWidth / e > f.boundHeight && f.boundHeight * e <= f.boundWidth){d.width = Math.round(f.boundHeight * e); d.height = f.boundHeight} else{d.width = f.boundWidth; d.height = Math.round(f.boundWidth / e)}}return d};